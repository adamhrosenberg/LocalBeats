<mat-card class="p-0">
  <mat-sidenav-container class="chat-container" style="background-color: rgba(245,245,245, 0.9);">
    <!-- Left sidebar -->
    <mat-sidenav class="chat-sidenav" #chatSidebar [opened]="isSidenavOpen" mode="side">
      <!-- Left side topbar -->
      <mat-toolbar color="primary" class="chat-sidebar-toolbar">
        <a href="" class="toolbar-avatar online">
          <img [src]="loggedInUser.profilePicUrl" alt="">
          <span class="status-dot"></span>
        </a>
      </mat-toolbar>
      <!-- Left side contact list -->
      <mat-nav-list class="inbox-nav-list" role="list">
        <mat-list-item
        *ngFor="let user of connectedUsers"
        (click)="changeActiveUser(user)">
          <a 
          mat-list-avatar 
          [ngClass]="{online: user.isOnline}"
          class="toolbar-avatar">
            <img [src]="user.profilePicUrl" alt="">
            <span class="status-dot"></span>
          </a>
          <h6 matLine>{{user.firstName + ' ' + user.lastName}}</h6>
          <!-- CHANGE TO INTERPOLATION ! <p matLine class="text-muted">{{user.lastMsg}}</p> -->
          <p matLine class="text-muted">"Last Msg: Gotta catch em all!"</p>
        </mat-list-item>
        
      </mat-nav-list>
    </mat-sidenav>

    <!-- Right side -->
    <div class="chats-wrap" style="min-height: 550px; max-height:650px">
      <!-- Right side topbar -->
      <mat-toolbar color="primary" class="chat-toolbar mb-1" style="position: sticky; top: 0">
        <!-- sidebar toggle button -->
        <button 
        mat-icon-button
        [style.alignSelf]="'center'"
        class="mr-1" 
        (click)="chatSidebar.toggle()"><mat-icon>short_text</mat-icon>
        </button>

        <!-- Selected active user -->
        <div 
        class="active-chat-user" 
        fxLayout="row" 
        fxLayoutAlign="start center">
          <a 
          [ngClass]="{online: activeChatUser.isOnline}" 
          class="toolbar-avatar mr-1">
            <img [src]="activeChatUser.profilePicUrl" alt="">
            <span class="status-dot"></span>
          </a>
          <div fxLayout="column">
            <h6 class="m-0 font-normal fz-1">{{activeChatUser.firstName + ' ' + activeChatUser.lastName}}</h6>
          </div>
        </div>

        <!-- Right side top menu -->
        <span fxFlex></span>
        <button 
        [style.alignSelf]="'center'" 
        mat-icon-button 
        [matMenuTriggerFor]="toolbarDDMenu" 
        class="topbar-button-right hidden-on-open">
            <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #toolbarDDMenu="matMenu">
            <button mat-menu-item><mat-icon>account_circle</mat-icon>Contact info</button>
            <button mat-menu-item><mat-icon>volume_mute</mat-icon>Mute</button>
            <button mat-menu-item><mat-icon>delete</mat-icon>Clear chat</button>
        </mat-menu>
      </mat-toolbar>

      <!-- Main chat body -->
      <div class="conversations-hold" style="min-height: 500px; position: sticky; top:0; z-index: -1;">
        <!-- single chat item -->
        <div *ngFor="let message of activeChatMessages" 
        class="single-conversation {{ !!(message.from._id == this.loggedInUser._id) ? 
                                      ('me') : 
                                      ('sender')}}" fxLayout="row">
          <a href="" class="toolbar-avatar online">
            <img [src]= "!!(message.from._id == this.loggedInUser._id) ? 
                        (this.loggedInUser.profilePicUrl) : 
                        (message.from.profilePicUrl)" alt="">
            <span class="status-dot"></span>
          </a>
          <div>
            <h5 class="chat-username text-muted">{{ !!(message.from._id === this.loggedInUser._id) ? 
                                                    (message.from.firstName + ' ' + message.from.lastName) : 
                                                    (message.to.firstName + ' ' + message.to.lastName) }}</h5>
            <div class="conversation-msg">
              {{message.content}}
            </div>
            <p class="chat-date text-muted">{{message.sentAt | date:'EEEE, MMM d, y, h:mm a'}}</p>
          </div>
        </div>

        
        
      </div>
      
      <!-- <mat-divider style="position:sticky; bottom: 11.65%;"></mat-divider> -->

      <!-- Input box and send button -->
      <div class="chat-input-actions" fxLayout="row" style="position: sticky; bottom: 20px; background-color: rgba(255,255,255,1); flex-direction: row; box-sizing: border-box; display: flex; border-radius: 5px; margin: 10px 10px 15px; box-shadow: 0px 10px 6px -6px rgba(150,150,150,0.2); border-style:solid; border-color:rgba(245,245,245,0.9); border-width:1px; padding: 10px 10px">
        <mat-form-field class="full-width mr-1">
          <input [(ngModel)]="messageEntered"
          matInput
          placeholder="Type your message"
          value="">
        </mat-form-field>
        <button mat-fab color="primary" (click)="sendMessageClicked()"><mat-icon>send</mat-icon></button>
      </div>

    </div>
  </mat-sidenav-container>
</mat-card>
