<div fxLayout="row" fxLayoutWrap="wrap">
  <div *ngIf="this.user" fxFlex="100" fxFlex.gt-md="300px" fxFlex.gt-sm="50">
    <mat-card class="profile-sidebar mb-1 pb-0">
      <div class="propic text-center">
        <img [src]="this.user.profilePicUrl" alt="">
      </div>
      <div class="profile-title text-center mb-1">
        <div class="main-title">{{this.user.firstName}}
          <b>{{this.user.lastName}}</b>
        </div>
        <!-- <div class="subtitle mb-05">Big Data Expert</div> -->
      </div>
      <div class="profile-actions text-center mb-1">
        <button *ngIf="!this.onOwnProfile && this.userService.isAuthenticated()" mat-raised-button color="primary" (click)="onStartNewConversationFromProfileButtonClick()">Message</button>
        <button *ngIf="!this.onOwnProfile && this.userService.isAuthenticated() && this.user.isArtist" mat-raised-button color="accent"
          (click)="clickedRequestArtist = true">Request Artist</button>
      </div>
      <div class="profile-nav">
        <mat-nav-list>
          <!-- check here if to see if on another profile and go to profile/id/overview -->
          <mat-list-item (click)="clickedOver()" routerLinkActive="list-item-active">
            <mat-icon>home</mat-icon>
            Overview
          </mat-list-item>

          <ng-template [ngIf]="this.onOwnProfile">
            <mat-list-item (click)="clickedOverview = false" [routerLink]="['/profile', 'events']" routerLinkActive="list-item-active">
              <mat-icon>events</mat-icon>
              My Hosted Events
            </mat-list-item>
          </ng-template>
          <ng-template [ngIf]="this.onOwnProfile && this.userService.user.isArtist">
            <mat-list-item (click)="clickedOverview = false" [routerLink]="['/profile', 'performances']" routerLinkActive="list-item-active">
              <mat-icon>music_note</mat-icon>
              My Performances
            </mat-list-item>
          </ng-template>

          <ng-template [ngIf]="this.onOwnProfile">
            <mat-divider></mat-divider>
            <mat-list-item [routerLink]="['/profile','settings']" routerLinkActive="list-item-active">
              <mat-icon>settings</mat-icon>
              Edit Profile
            </mat-list-item>
          </ng-template>

        </mat-nav-list>
      </div>
    </mat-card>

    <!-- Contact Information -->
    <mat-card class="default">
      <mat-card-title>Contact Information</mat-card-title>
      <mat-card-content class="pt-0">
        <mat-list>
          <mat-list-item>
            <mat-icon class="mr-1">email</mat-icon> {{this.user.email}}</mat-list-item>
        </mat-list>
      </mat-card-content>
    </mat-card>

    <!-- Spotify Widget -->
    <mat-card class="default" *ngIf="this.userService.isAuthenticated()">
      <mat-card-title>Music Corner</mat-card-title>
      <mat-card-content class="pt-0">

        <mat-tab-group class="music-tab-group">
          
          <mat-tab label="Spotify">
            <!-- <ng-template mat-tab-label> -->
              <!-- <mat-icon>security</mat-icon> -->
            <!-- </ng-template> -->
            <div class="spotify-tab-content" [style.overflow]="'auto'" [style.height.px]="'300'">
              <!-- Link spotify button -->
              <a *ngIf="this.user.spotify === undefined" mat-raised-button (click)="authorizeSpotify()" color="primary">Connect Spotify</a>

              <!-- Spotify list of albums -->
              <mat-list dense *ngIf="this.user.spotify !== undefined && !this.onSpotifyWidget">
                <h3 mat-subheader>Albums</h3>
                <mat-list-item id="spotifyList" *ngFor="let album of this.user.spotify.albums" (click)="onAlbumRowClicked(album)">
                  <!-- <mat-icon mat-list-icon>folder</mat-icon> -->
                  <img matListAvatar [src]="this.getSanitizedUrl(album.images[2].url)" alt="album.name">
                  <h3 mat-line>{{album.name}}</h3>
                  <p mat-line> Released on {{album.release_date}} </p>
                </mat-list-item>
              </mat-list>

              <!-- Spotify album widget for clicked album listItem -->
              <iframe *ngIf="this.onSpotifyWidget" [src]="this.trustedAlbumUrl" width=100% height=100% frameborder="0" allowtransparency="true"></iframe>
            </div>
          </mat-tab>


          <mat-tab label="SoundCloud">
            <!-- <ng-template mat-tab-label>
              <mat-icon>attach_file</mat-icon>
            </ng-template> -->
            <div class="soundcloud-tab-content" [style.overflow]="'auto'" [style.height.px]="'300'">
                
                <div class="soundcloud-register-container" *ngIf="this.user.soundcloud === undefined">
                  <mat-form-field (keydown)="registerSoundcloudClicked($event)" floatLabel="never" hintLabel="Tip: ID can be found in your account's URL">
                      <input matInput [(ngModel)]="soundcloudIdFormInput" placeholder="Register your SoundCloud ID">
                  </mat-form-field>
                </div>
                <!-- <a *ngIf="this.user.soundcloud === undefined" mat-raised-button (click)="authorizeSoundcloud()" color="primary">Connect Spotify</a> -->

            </div>
          </mat-tab>
        </mat-tab-group>


      </mat-card-content>

      <mat-card-actions>
        <!-- <h4 mat-subheader *ngIf="!this.onSpotifyWidget">Album Count : {{this.user.spotify.albums.length}}</h4> -->
        <button mat-button *ngIf="this.onSpotifyWidget" (click)="backToSpotifyAlbumsClicked()">
          <mat-icon>arrow_back</mat-icon> Back to Albums</button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Profile Views -->
  <div fxFlex="100" fxFlex.gt-sm="50" fxFlex.gt-md="calc(100% - 300px)">
    <router-outlet></router-outlet>
    <app-profile-request *ngIf="clickedRequestArtist" [user]="userService.user" [artist]="user"></app-profile-request>
    <app-profile-overview *ngIf="clickedOverview" [user]="this.user"></app-profile-overview>
  </div>
</div>